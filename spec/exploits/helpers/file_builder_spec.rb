require 'spec_helper'
require 'ronin/exploits/local'
require 'ronin/exploits/helpers/file_builder'

describe Exploits::Helpers::FileBuilder do
  subject do
    Exploits::Local.object do
      helper :file_builder

      self.name = 'file exploit'
      self.output_file_name = 'file_exploit.dat'

      build do
        build_file do |file|
          file << 'some data'
        end
      end
    end
  end

  it "should have a default output directory" do
    expect(subject.output_dir).to eq(Ronin::Config::TMP_DIR.to_s)
  end

  it "should have a default output_file_name, based on the exploit name" do
    expect(subject.output_file_name).to eq('file_exploit.dat')
  end

  it "should have an empty output_file_paths list by default" do
    expect(subject.output_file_paths).to be_empty
  end

  context "when built" do
    before { subject.build! }

    it "should add the paths of built files to output_file_paths" do
      expect(subject.output_file_paths.length).to eq(1)
    end

    it "should create a file" do
      expect(File.read(subject.output_file_paths.first)).to eq('some data')
    end
  end
end
