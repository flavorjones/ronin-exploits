require 'spec_helper'
require 'ronin/exploits/params/port_with_default'
require 'ronin/exploits/exploit'

describe Ronin::Exploits::Params::PortWithDefault do
  module TestPortWithDefault
    class TestExploit < Ronin::Exploits::Exploit
      include Ronin::Exploits::Params::PortWithDefault.new(443)
    end
  end

  let(:port) { 443 }

  subject { described_class.new(port) }

  describe "#initialize" do
    it "must set #port" do
      expect(subject.port).to eq(port)
    end
  end

  describe "#included" do
    subject { TestPortWithDefault::TestExploit }

    it "must a 'port' param with a default value" do
      expect(subject.params[:port]).to_not be(nil)
      expect(subject.params[:port].default).to eq(443)
      expect(subject.params[:port].desc).to eq("Remote port to connect to")
    end
  end

  let(:port) { 1337 }
  subject { TestPortWithDefault::TestExploit.new(params: {port: port}) }

  describe "#port" do
    it "must return the port param value" do
      expect(subject.port).to eq(port)
    end
  end
end
