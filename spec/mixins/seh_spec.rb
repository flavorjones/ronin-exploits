require 'spec_helper'
require 'ronin/exploits/mixins/seh'

require 'ronin/exploits/exploit'
require 'ronin/exploits/metadata/arch'
require 'ronin/exploits/metadata/os'

describe Ronin::Exploits::Mixins::SEH do
  module TestSEHMixin
    class TestExploit < Ronin::Exploits::Exploit
      include Ronin::Exploits::Metadata::Arch
      include Ronin::Exploits::Metadata::OS
      include Ronin::Exploits::Mixins::SEH

      arch :x86
      os :windows
    end
  end

  let(:exploit_command) { TestSEHMixin::TestExploit }

  subject { exploit_command.new }

  describe "#seh_record" do
    let(:nseh) { 0x06eb9090 }
    let(:seh)  { 0x1001ae86 }

    it "must pack the nseh and seh arguments as machine words" do
      expect(subject.seh_record(nseh,seh)).to eq(
        [nseh, seh].pack('<L2')
      )
    end
  end
end
