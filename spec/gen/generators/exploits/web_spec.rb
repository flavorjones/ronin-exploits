require 'spec_helper'
require 'ronin/gen/generators/exploits/web'
require 'ronin/exploits/web'

require 'gen/generators/exploits/exploit_examples'
require 'tmpdir'
require 'fileutils'

describe Gen::Generators::Exploits::Web do
  let(:path) { File.join(Dir.tmpdir,'generated_web_exploit.rb') }

  before(:all) do
    described_class.generate(
      path,
      edit:      false,
      helpers:   %w[buffer_overflow],
      url_path:  '/some/path',
      url_query: 'var=1'
    )
  end

  subject { Exploits::Web.load_object(path) }

  it_should_behave_like "a generated Exploit"

  it "should define a Web exploit" do
    expect(subject.class).to eq(Exploits::Web)
  end

  it "should define helpers to load" do
    expect(subject).to be_kind_of(Exploits::Helpers::BufferOverflow)
  end

  it "should set the url_path property" do
    expect(subject.url_path).to eq('/some/path')
  end

  it "should set the url_query property" do
    expect(subject.url_query).to eq('var=1')
  end

  after(:all) { FileUtils.rm(path) }
end
